import{_ as O}from"./AuthenticatedLayout-f04d8c74.js";import{r as _,o,s as f,e as $,d as D,u as E,Z as V,f as e,b as n,t as i,j as a,F as y,i as v,p as w,m as d,K as b,O as x}from"./app-de19c82f.js";import{S as l}from"./sweetalert2.esm.all-509645c6.js";import{_ as M}from"./ReceiptModal-6794c8dd.js";import"./ApplicationLogo-32c770cc.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./ResponsiveNavLink-b247280f.js";import"./Modal-a392b577.js";const N={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 py-12"},A=e("h2",{class:"text-2xl font-semibold mb-6 text-center"},"Purchase History",-1),F={key:0,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4"},R={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},K={key:2,class:"flex items-center justify-center h-64"},U=e("div",{class:"flex flex-col items-center"},[e("div",{class:"text-center text-gray-500 mb-4"}," No purchases found. "),e("div",{class:"animate-float"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3h18M3 3l3 18h12l3-18M3 3l3 18h12l3-18"})])])],-1),L=[U],I={key:3},z={class:"min-w-full divide-y divide-gray-200"},G=e("thead",null,[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Transaction No"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Items"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Total Amount"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Status"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Pickup Status"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Date"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Actions")])],-1),q={class:"divide-y divide-gray-200"},H={class:"px-6 py-4"},J={class:"px-6 py-4"},Y={class:"px-6 py-4"},Q={class:"px-6 py-4"},Z={class:"px-6 py-4"},W={key:0,class:"text-green-600 text-sm font-medium"},X={key:1,class:"space-y-2"},ee=e("span",{class:"px-2 py-1 bg-green-100 text-green-800 rounded text-xs font-medium block"}," Ready for Pickup ",-1),te={class:"text-xs text-gray-500"},oe={key:2,class:"text-gray-500 text-sm"},se={class:"px-6 py-4"},ne={class:"px-6 py-4 space-y-2"},ie=["onClick"],re={key:1,class:"text-sm text-red-600 mb-2"},ae={key:2,class:"text-sm text-amber-600 mb-2"},le={key:3,class:"space-y-2"},ce=["onChange"],de=["onClick"],ue={key:0,class:"text-sm text-gray-500"},pe=["href"],fe=["onClick"],me=["onClick"],_e={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},ye={class:"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg"},xe=e("h3",{class:"text-lg font-semibold"},"Purchase Report",-1),ge=e("span",{class:"sr-only"},"Close",-1),he=e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),ke=[ge,he],ve={class:"space-y-4"},we=e("strong",null,"Transaction ID:",-1),be=e("strong",null,"Medicine:",-1),Pe=e("strong",null,"Quantity:",-1),Ce=e("strong",null,"Total Amount:",-1),Be=e("strong",null,"Status:",-1),Te=e("strong",null,"Purchase Date:",-1),Ne={__name:"Index",props:{purchases:Array},setup(g){const c=_(null),m=_(!1),P=_("");function C(){c.value=null}function h(s){switch(s){case"pending":return"Pending";case"confirmed":return"Confirmed";case"completed":return"Completed";case"cancelled":return"Cancelled";case"rejected":return"Rejected";default:return s}}function B(s){confirm("Are you sure you want to cancel this purchase?")&&x.delete(route("purchase.cancel",s.transaction_id))}function T(s){if(s.payment_status!=="verified"){l.fire({title:"Cannot Verify Pickup",text:"Please wait for admin to verify your payment proof first.",icon:"warning",confirmButtonText:"OK"});return}l.fire({title:"Verify Pickup",text:"Are you sure you want to verify this pickup? This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, verify pickup",cancelButtonText:"Cancel"}).then(u=>{u.isConfirmed&&x.post(route("purchase.verify-pickup",s.transaction_id),{},{onSuccess:()=>{l.fire({title:"Pickup Verified!",text:"Thank you for verifying your pickup.",icon:"success",timer:2e3,showConfirmButton:!1})},onError:t=>{l.fire({title:"Error",text:t.message||"Failed to verify pickup. Please try again.",icon:"error",confirmButtonText:"OK"})}})})}const j=async(s,u)=>{if(!s)return;if(s.size>2*1024*1024){l.fire({title:"Error!",text:"File size must be less than 2MB",icon:"error",confirmButtonText:"OK"});return}if(!["image/jpeg","image/png","image/jpg"].includes(s.type)){l.fire({title:"Error!",text:"Only JPG, JPEG, and PNG files are allowed",icon:"error",confirmButtonText:"OK"});return}const r=l.fire({title:"Uploading...",text:"Please wait while we upload your payment proof",allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>{l.showLoading()}}),k=new FormData;k.append("payment_proof",s);try{await x.post(route("purchase.upload-payment-proof",u),k,{preserveScroll:!0,onBefore:()=>{},onSuccess:()=>{r.close(),l.fire({title:"Success!",text:"Payment proof uploaded successfully. Please wait for admin verification.",icon:"success",timer:3e3,showConfirmButton:!1})},onError:p=>{r.close(),console.error("Upload error:",p),l.fire({title:"Error!",text:p.payment_proof||Object.values(p)[0]||"Failed to upload payment proof. Please try again.",icon:"error",confirmButtonText:"OK"})},onFinish:()=>{}})}catch(p){r.close(),console.error("Unexpected error:",p),l.fire({title:"Error!",text:"An unexpected error occurred while uploading the payment proof. Please try again.",icon:"error",confirmButtonText:"OK"})}};function S(s){window.open(route("purchase.report",s.transaction_id),"_blank")}return(s,u)=>(o(),f(O,null,{default:$(()=>[D(E(V),{title:"Purchase History"}),e("div",N,[A,s.$page.props.flash.success?(o(),n("div",F,i(s.$page.props.flash.success),1)):a("",!0),s.$page.props.flash.error?(o(),n("div",R,i(s.$page.props.flash.error),1)):a("",!0),g.purchases.length===0?(o(),n("div",K,L)):(o(),n("div",I,[e("table",z,[G,e("tbody",q,[(o(!0),n(y,null,v(g.purchases,t=>(o(),n("tr",{key:t.transaction_id},[e("td",H,i(t.transaction_number),1),e("td",J,[(o(!0),n(y,null,v(t.items,r=>(o(),n("div",{key:r.id,class:"mb-2"},i(r.name)+" ("+i(r.quantity)+"x) - ₱"+i(r.total_amount),1))),128))]),e("td",Y,"₱"+i(t.total_amount),1),e("td",Q,[e("span",{class:w({"px-2 py-1 rounded text-xs font-medium":!0,"bg-yellow-100 text-yellow-800":t.status==="pending","bg-blue-100 text-blue-800":t.status==="confirmed","bg-green-400 text-black-800":t.status==="completed","bg-red-100 text-red-800":t.status==="cancelled"})},i(h(t.status)),3)]),e("td",Z,[t.user_pickup_verified&&t.admin_pickup_verified?(o(),n("div",W," Done ")):t.ready_for_pickup?(o(),n("div",X,[ee,t.pickup_deadline?(o(),n(y,{key:0},[e("p",te," Pickup Before: "+i(new Date(t.pickup_deadline).toLocaleString()),1),e("p",{class:w(["text-xs font-medium",{"text-red-600":t.time_remaining==="Expired","text-blue-600":t.time_remaining!=="Expired"}])},i(t.time_remaining),3)],64)):a("",!0)])):(o(),n("span",oe," Not Ready Yet "))]),e("td",se,i(new Date(t.created_at).toLocaleDateString()),1),e("td",ne,[t.status==="pending"?(o(),n("button",{key:0,onClick:r=>B(t),class:"w-full px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded text-sm"}," Cancel ",8,ie)):a("",!0),t.payment_status==="rejected"?(o(),n("div",re," Payment proof was rejected. Please upload a new one. ")):a("",!0),t.payment_status==="pending"?(o(),n("div",ae," Payment proof is pending verification. ")):a("",!0),(t.status==="confirmed"||t.status==="ready_for_pickup")&&t.payment_status!=="verified"&&(t.payment_status==="pending"||t.payment_status==="rejected"||!t.payment_status)?(o(),n("div",le,[e("input",{type:"file",ref_for:!0,ref:"fileInput"+t.transaction_id,onChange:r=>j(r.target.files[0],t.transaction_id),accept:"image/*,.pdf",class:"hidden"},null,40,ce),e("button",{onClick:r=>s.$refs["fileInput"+t.transaction_id][0].click(),class:"w-full px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},i(t.payment_status==="rejected"?"Upload New Payment Proof":"Upload Payment Proof"),9,de),t.payment_proof_url?(o(),n("div",ue,[d(" Payment Proof: "),e("a",{href:t.payment_proof_url,target:"_blank",class:"text-indigo-600 hover:text-indigo-800"}," View ",8,pe)])):a("",!0)])):a("",!0),t.ready_for_pickup&&!t.user_pickup_verified&&t.payment_status==="verified"?(o(),n("button",{key:4,onClick:r=>T(t),class:"w-full px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm"}," Verify Pickup ",8,fe)):a("",!0),t.status==="completed"?(o(),n("button",{key:5,onClick:r=>S(t),class:"w-full text-green-600 hover:text-green-900 bg-green-100 px-3 py-1 rounded-full"}," View Receipt ",8,me)):a("",!0)])]))),128))])])])),(o(),f(b,{to:"body"},[c.value?(o(),n("div",_e,[e("div",ye,[e("div",{class:"flex justify-between items-center mb-4"},[xe,e("button",{onClick:C,class:"text-gray-500 hover:text-gray-700"},ke)]),e("div",ve,[e("p",null,[we,d(" "+i(c.value.transaction_number),1)]),e("p",null,[be,d(" "+i(c.value.name),1)]),e("p",null,[Pe,d(" "+i(c.value.quantity),1)]),e("p",null,[Ce,d(" ₱"+i(c.value.total_amount),1)]),e("p",null,[Be,d(" "+i(h(c.value.status)),1)]),e("p",null,[Te,d(" "+i(new Date(c.value.created_at).toLocaleString()),1)])])])])):a("",!0)])),(o(),f(b,{to:"body"},[m.value?(o(),f(M,{key:0,show:m.value,"receipt-url":P.value,onClose:u[0]||(u[0]=t=>m.value=!1)},null,8,["show","receipt-url"])):a("",!0)]))])]),_:1}))}};export{Ne as default};
